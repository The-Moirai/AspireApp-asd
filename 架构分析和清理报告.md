# .NETé¡¹ç›®æ¶æ„åˆ†æå’Œæ¸…ç†æŠ¥å‘Š

## ğŸ“‹ é¡¹ç›®æ¦‚è§ˆ

### é¡¹ç›®ç»“æ„
```
AspireApp-asd/
â”œâ”€â”€ AspireApp.AppHost/           # Aspireåº”ç”¨ä¸»æœº
â”œâ”€â”€ AspireApp.ServiceDefaults/   # æœåŠ¡é»˜è®¤é…ç½®
â”œâ”€â”€ BlazorApp_Web/              # Blazor Webåº”ç”¨
â”œâ”€â”€ ClassLibrary_Core/          # æ ¸å¿ƒç±»åº“
â”œâ”€â”€ WebApplication_Drone/       # æ— äººæœºWeb API
â”œâ”€â”€ linux_code/                # Pythonåç«¯ä»£ç 
â””â”€â”€ load_balancing/            # è´Ÿè½½å‡è¡¡ç®—æ³•
```

## ğŸ—ï¸ æ¶æ„åˆ†æï¼ˆä»¥å‡½æ•°ä¸ºæœ€å°å•ä½ï¼‰

### 1. æ ¸å¿ƒç±»åº“ (ClassLibrary_Core)

#### 1.1 æ•°æ®æ¨¡å‹å±‚
```csharp
// æ— äººæœºç›¸å…³
â”œâ”€â”€ Drone/
â”‚   â”œâ”€â”€ Drone.cs                    # æ— äººæœºå®ä½“
â”‚   â”œâ”€â”€ DroneStatus.cs              # æ— äººæœºçŠ¶æ€æšä¸¾
â”‚   â””â”€â”€ ModelStatus.cs              # æ¨¡å‹çŠ¶æ€æšä¸¾
â”‚
// ä»»åŠ¡ç›¸å…³
â”œâ”€â”€ Mission/
â”‚   â”œâ”€â”€ MainTask.cs                 # ä¸»ä»»åŠ¡å®ä½“
â”‚   â”œâ”€â”€ SubTask.cs                  # å­ä»»åŠ¡å®ä½“
â”‚   â”œâ”€â”€ MissionStatus.cs            # ä»»åŠ¡çŠ¶æ€æšä¸¾
â”‚   â””â”€â”€ MissionHistory.cs           # ä»»åŠ¡å†å²
â”‚
// æ•°æ®ä¼ è¾“å¯¹è±¡
â”œâ”€â”€ Data/
â”‚   â”œâ”€â”€ DroneDataPoint.cs           # æ— äººæœºæ•°æ®ç‚¹
â”‚   â”œâ”€â”€ DroneDataRequest.cs         # æ— äººæœºæ•°æ®è¯·æ±‚
â”‚   â”œâ”€â”€ DroneStatusHistory.cs       # æ— äººæœºçŠ¶æ€å†å²
â”‚   â”œâ”€â”€ SubTaskImage.cs             # å­ä»»åŠ¡å›¾ç‰‡æ•°æ®
â”‚   â”œâ”€â”€ TaskTimeRange.cs            # ä»»åŠ¡æ—¶é—´èŒƒå›´
â”‚   â””â”€â”€ TimeRangeData.cs            # æ—¶é—´èŒƒå›´æ•°æ®
â”‚
// é€šä¿¡æ¶ˆæ¯
â”œâ”€â”€ Message/
â”‚   â”œâ”€â”€ Message.cs                  # åŸºç¡€æ¶ˆæ¯
â”‚   â”œâ”€â”€ MessageFromNode.cs          # èŠ‚ç‚¹æ¶ˆæ¯
â”‚   â””â”€â”€ Message_Send.cs             # å‘é€æ¶ˆæ¯
â”‚
// é€šç”¨ç»„ä»¶
â””â”€â”€ Common/
    â”œâ”€â”€ GPSPosition.cs              # GPSä½ç½®
    â””â”€â”€ TaskUploadDto.cs            # ä»»åŠ¡ä¸Šä¼ DTO
```

#### 1.2 å‡½æ•°çº§åˆ«åˆ†æ

**GPSPosition.cs ä¸»è¦å‡½æ•°:**
- `ToString()` - GPSåæ ‡æ ¼å¼åŒ–æ˜¾ç¤º
- `DistanceTo(GPSPosition other)` - è®¡ç®—ä¸¤ç‚¹é—´è·ç¦»

**SubTaskImage.cs ä¸»è¦å‡½æ•°:**
- `GetImageUrl()` - ç”Ÿæˆå›¾ç‰‡è®¿é—®URL
- `GetFormattedFileSize()` - æ ¼å¼åŒ–æ–‡ä»¶å¤§å°æ˜¾ç¤º

**TaskStatistics.cs ä¸»è¦å‡½æ•°:**
- `MainTaskCompletionRate` - ä¸»ä»»åŠ¡å®Œæˆç‡è®¡ç®—
- `SubTaskCompletionRate` - å­ä»»åŠ¡å®Œæˆç‡è®¡ç®—
- `MainTaskFailureRate` - ä¸»ä»»åŠ¡å¤±è´¥ç‡è®¡ç®—
- `SubTaskFailureRate` - å­ä»»åŠ¡å¤±è´¥ç‡è®¡ç®—

### 2. æ— äººæœºWeb API (WebApplication_Drone)

#### 2.1 æ§åˆ¶å™¨å±‚
```csharp
â”œâ”€â”€ Controllers/
â”‚   â”œâ”€â”€ DronesController.cs         # æ— äººæœºç®¡ç†API
â”‚   â”œâ”€â”€ TasksController.cs          # ä»»åŠ¡ç®¡ç†API
â”‚   â”œâ”€â”€ HistoryDataController.cs    # å†å²æ•°æ®API

```

**ä¸»è¦APIç«¯ç‚¹åˆ†æ:**

**DronesController ä¸»è¦å‡½æ•°:**
- `GetAllDrones()` - è·å–æ‰€æœ‰æ— äººæœº
- `GetDrone(Guid id)` - è·å–æŒ‡å®šæ— äººæœº
- `CreateDrone(Drone drone)` - åˆ›å»ºæ— äººæœº
- `UpdateDrone(Guid id, Drone drone)` - æ›´æ–°æ— äººæœº
- `DeleteDrone(Guid id)` - åˆ é™¤æ— äººæœº

**TasksController ä¸»è¦å‡½æ•°:**
- `GetAllTasks()` - è·å–æ‰€æœ‰ä»»åŠ¡
- `GetTask(Guid id)` - è·å–æŒ‡å®šä»»åŠ¡
- `CreateTask(MainTask task)` - åˆ›å»ºä»»åŠ¡
- `UpdateTask(Guid id, MainTask task)` - æ›´æ–°ä»»åŠ¡
- `DeleteTask(Guid id)` - åˆ é™¤ä»»åŠ¡
- `AssignSubTask(Guid taskId, Guid subTaskId, string droneName)` - åˆ†é…å­ä»»åŠ¡

**TasksController å›¾ç‰‡ç®¡ç†åŠŸèƒ½:**
- `GetSubTaskImages()` - è·å–å­ä»»åŠ¡æ‰€æœ‰å›¾ç‰‡
- `GetTaskImagesSummary()` - è·å–ä»»åŠ¡å›¾ç‰‡ç»Ÿè®¡
- `GetImage()` - è·å–å›¾ç‰‡å†…å®¹
- `GetThumbnail()` - è·å–ç¼©ç•¥å›¾
- `GetRecentImages()` - è·å–æœ€è¿‘å›¾ç‰‡

#### 2.2 æœåŠ¡å±‚
```csharp
â”œâ”€â”€ Services/
â”‚   â”œâ”€â”€ TaskDataService.cs          # ä»»åŠ¡æ•°æ®æœåŠ¡
â”‚   â”œâ”€â”€ DroneDataService.cs         # æ— äººæœºæ•°æ®æœåŠ¡
â”‚   â”œâ”€â”€ SqlserverService.cs         # SQL Serveræ•°æ®è®¿é—®æœåŠ¡
â”‚   â”œâ”€â”€ MissionSocketService.cs     # ä»»åŠ¡Socketé€šä¿¡æœåŠ¡
â”‚   â””â”€â”€ SocketBackgroundService.cs  # Socketåå°æœåŠ¡
```

**TaskDataService ä¸»è¦å‡½æ•°åˆ†æ:**
- **æ•°æ®ç®¡ç†å‡½æ•°:**
  - `GetTasks()` - è·å–æ‰€æœ‰ä»»åŠ¡ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰
  - `GetTask(Guid id)` - è·å–æŒ‡å®šä»»åŠ¡
  - `SetTasks(IEnumerable<MainTask> tasks)` - è®¾ç½®ä»»åŠ¡åˆ—è¡¨
  - `AddTask(MainTask task, string createdBy)` - æ·»åŠ æ–°ä»»åŠ¡
  - `UpdateTask(MainTask task)` - æ›´æ–°ä»»åŠ¡
  - `DeleteTask(Guid id)` - åˆ é™¤ä»»åŠ¡

- **å­ä»»åŠ¡ç®¡ç†å‡½æ•°:**
  - `UnloadSubTask(Guid mainTaskId, Guid subTaskId)` - å¸è½½å­ä»»åŠ¡
  - `ReloadSubTask(Guid mainTaskId, Guid subTaskId, string droneName)` - é‡è½½å­ä»»åŠ¡
  - `AssignSubTask(Guid mainTaskId, Guid subTaskId, string droneName)` - åˆ†é…å­ä»»åŠ¡
  - `CompleteSubTask(Guid mainTaskId, string subTaskDescription)` - å®Œæˆå­ä»»åŠ¡
  - `GetSubTasks(Guid mainTaskId)` - è·å–å­ä»»åŠ¡åˆ—è¡¨
  - `addSubTasks(Guid mainTaskId, SubTask subTask)` - æ·»åŠ å­ä»»åŠ¡

- **æ•°æ®åˆ†æå‡½æ•°:**
  - `GetTaskDroneDataAsync(Guid taskId, Guid droneId)` - è·å–ä»»åŠ¡æ— äººæœºæ•°æ®
  - `GetTaskAllDronesDataAsync(Guid taskId)` - è·å–ä»»åŠ¡æ‰€æœ‰æ— äººæœºæ•°æ®
  - `GetTaskStatistics()` - è·å–ä»»åŠ¡ç»Ÿè®¡ä¿¡æ¯
  - `GetTaskPerformanceAnalysis()` - è·å–ä»»åŠ¡æ€§èƒ½åˆ†æ

- **æ•°æ®åº“åŒæ­¥å‡½æ•°:**
  - `LoadTasksFromDatabaseAsync()` - ä»æ•°æ®åº“åŠ è½½ä»»åŠ¡
  - `SyncAllTasksToDatabaseAsync()` - åŒæ­¥æ‰€æœ‰ä»»åŠ¡åˆ°æ•°æ®åº“
  - `LoadSubTaskImagesFromDatabaseAsync()` - åŠ è½½å­ä»»åŠ¡å›¾ç‰‡

- **æ‰¹é‡æ“ä½œå‡½æ•°:**
  - `BatchUpdateSubTaskStatusAsync()` - æ‰¹é‡æ›´æ–°å­ä»»åŠ¡çŠ¶æ€
  - `ReassignFailedSubTasksAsync()` - é‡æ–°åˆ†é…å¤±è´¥çš„å­ä»»åŠ¡
  - `CleanupOldCompletedTasksAsync()` - æ¸…ç†æ—§çš„å·²å®Œæˆä»»åŠ¡

**SqlserverService ä¸»è¦å‡½æ•°åˆ†æ:**
- **è¿æ¥ç®¡ç†å‡½æ•°:**
  - `CreateConnectionAsync()` - åˆ›å»ºæ•°æ®åº“è¿æ¥
  - `ExecuteNonQueryAsync(string sql, params SqlParameter[] parameters)` - æ‰§è¡ŒéæŸ¥è¯¢SQL
  - `ExecuteReaderAsync(string sql, params SqlParameter[] parameters)` - æ‰§è¡ŒæŸ¥è¯¢SQL

- **æ— äººæœºæ•°æ®å‡½æ•°:**
  - `AddDroneAsync(Drone drone)` - æ·»åŠ æ— äººæœº
  - `GetAllDronesAsync()` - è·å–æ‰€æœ‰æ— äººæœº
  - `GetDroneAsync(Guid droneId)` - è·å–æŒ‡å®šæ— äººæœº
  - `GetDroneByNameAsync(string droneName)` - æŒ‰åç§°è·å–æ— äººæœº
  - `UpdateDroneHeartbeatAsync(Guid droneId)` - æ›´æ–°æ— äººæœºå¿ƒè·³
  - `FullSyncDroneAsync(Drone drone)` - å®Œæ•´åŒæ­¥æ— äººæœºæ•°æ®
  - `BulkUpdateDrones(IEnumerable<Drone> drones)` - æ‰¹é‡æ›´æ–°æ— äººæœº

- **ä»»åŠ¡æ•°æ®å‡½æ•°:**
  - `AddMainTaskAsync(MainTask task, string createdBy)` - æ·»åŠ ä¸»ä»»åŠ¡
  - `AddSubTaskAsync(SubTask subTask)` - æ·»åŠ å­ä»»åŠ¡
  - `GetAllMainTasksAsync()` - è·å–æ‰€æœ‰ä¸»ä»»åŠ¡
  - `GetSubTasksByParentAsync(Guid parentTaskId)` - è·å–å­ä»»åŠ¡
  - `FullSyncMainTaskAsync(MainTask mainTask)` - å®Œæ•´åŒæ­¥ä¸»ä»»åŠ¡
  - `DeleteMainTaskAsync(Guid taskId)` - åˆ é™¤ä¸»ä»»åŠ¡

- **å›¾ç‰‡æ•°æ®å‡½æ•°:**
  - `SaveSubTaskImageAsync()` - ä¿å­˜å­ä»»åŠ¡å›¾ç‰‡
  - `GetSubTaskImagesAsync(Guid subTaskId)` - è·å–å­ä»»åŠ¡å›¾ç‰‡åˆ—è¡¨
  - `GetSubTaskImageAsync(long imageId)` - è·å–æŒ‡å®šå›¾ç‰‡
  - `DeleteSubTaskImagesAsync(Guid subTaskId)` - åˆ é™¤å­ä»»åŠ¡æ‰€æœ‰å›¾ç‰‡

- **å†å²æ•°æ®å‡½æ•°:**
  - `GetDroneStatusHistoryAsync()` - è·å–æ— äººæœºçŠ¶æ€å†å²
  - `RecordDroneStatusFromDroneAsync(Drone drone)` - è®°å½•æ— äººæœºçŠ¶æ€
  - `GetDroneDataInTimeRangeAsync()` - è·å–æ—¶é—´èŒƒå›´å†…æ— äººæœºæ•°æ®
  - `GetAllDronesDataInTimeRangeAsync()` - è·å–æ‰€æœ‰æ— äººæœºæ—¶é—´èŒƒå›´æ•°æ®

**MissionSocketService ä¸»è¦å‡½æ•°åˆ†æ:**
- **è¿æ¥ç®¡ç†å‡½æ•°:**
  - `StartAsync(int port)` - å¯åŠ¨SocketæœåŠ¡
  - `HandleClientAsync(TcpClient client)` - å¤„ç†å®¢æˆ·ç«¯è¿æ¥
  - `Stop()` - åœæ­¢æœåŠ¡

- **æ¶ˆæ¯å¤„ç†å‡½æ•°:**
  - `ReadJsonMessageFromStream(NetworkStream stream)` - ä»æµè¯»å–JSONæ¶ˆæ¯
  - `TryParseJsonFromBuffer()` - è§£æJSONç¼“å†²åŒº
  - `ProcessMessage(MessageFromNode message, NetworkStream stream)` - å¤„ç†æ¶ˆæ¯
  - `ProcessTaskInfo(MessageFromNode message)` - å¤„ç†ä»»åŠ¡ä¿¡æ¯
  - `ProcessTaskResult(MessageFromNode message)` - å¤„ç†ä»»åŠ¡ç»“æœ

- **å›¾ç‰‡ä¼ è¾“å‡½æ•°:**
  - `ProcessSingleImageWithHeader()` - å¤„ç†å•å¼ å›¾ç‰‡ï¼ˆå¸¦å¤´ä¿¡æ¯ï¼‰
  - `ProcessImageDataDirect()` - ç›´æ¥å¤„ç†å›¾ç‰‡æ•°æ®
  - `SaveImageToDatabase()` - ä¿å­˜å›¾ç‰‡åˆ°æ•°æ®åº“
  - `SaveImageToFileSystem()` - ä¿å­˜å›¾ç‰‡åˆ°æ–‡ä»¶ç³»ç»Ÿ
  - `ReadExactBytes(NetworkStream stream, byte[] buffer, int count)` - ç²¾ç¡®è¯»å–å­—èŠ‚

### 3. Blazor Webåº”ç”¨ (BlazorApp_Web)

#### 3.1 é¡µé¢ç»„ä»¶
```csharp
â”œâ”€â”€ Components/Pages/
â”‚   â”œâ”€â”€ Drone_Map.razor             # æ— äººæœºåœ°å›¾é¡µé¢
â”‚   â”œâ”€â”€ Task_Manage.razor           # ä»»åŠ¡ç®¡ç†é¡µé¢
â”‚   â”œâ”€â”€ Drone_Manage.razor          # æ— äººæœºç®¡ç†é¡µé¢
â”‚   â”œâ”€â”€ History_Data.razor          # å†å²æ•°æ®é¡µé¢
â”‚   â””â”€â”€ Home.razor                  # é¦–é¡µ
â”‚
â”œâ”€â”€ Components/Subassembly/
â”‚   â”œâ”€â”€ DataManagementTab.razor     # æ•°æ®ç®¡ç†æ ‡ç­¾é¡µ
â”‚   â”œâ”€â”€ DroneDataAnalysis.razor     # æ— äººæœºæ•°æ®åˆ†æ
â”‚   â”œâ”€â”€ EnhancedTimeRangeAnalysis.razor # å¢å¼ºæ—¶é—´èŒƒå›´åˆ†æ
â”‚   â””â”€â”€ TaskManagementTab.razor     # ä»»åŠ¡ç®¡ç†æ ‡ç­¾é¡µ
```

#### 3.2 SignalR Hub
```csharp
â”œâ”€â”€ Hubs/
â”‚   â”œâ”€â”€ DroneHub.cs                 # æ— äººæœºå®æ—¶é€šä¿¡Hub
â”‚   â””â”€â”€ TaskHub.cs                  # ä»»åŠ¡å®æ—¶é€šä¿¡Hub
```

**DroneHub ä¸»è¦å‡½æ•°:**
- `SendDroneUpdate(string droneId, object data)` - å‘é€æ— äººæœºæ›´æ–°
- `JoinDroneGroup(string droneId)` - åŠ å…¥æ— äººæœºç»„
- `LeaveDroneGroup(string droneId)` - ç¦»å¼€æ— äººæœºç»„

**TaskHub ä¸»è¦å‡½æ•°:**
- `SendTaskUpdate(string taskId, object data)` - å‘é€ä»»åŠ¡æ›´æ–°
- `JoinTaskGroup(string taskId)` - åŠ å…¥ä»»åŠ¡ç»„
- `LeaveTaskGroup(string taskId)` - ç¦»å¼€ä»»åŠ¡ç»„

#### 3.3 åå°æœåŠ¡
```csharp
â”œâ”€â”€ Service/
â”‚   â”œâ”€â”€ DronePushBackgroundService.cs   # æ— äººæœºæ•°æ®æ¨é€åå°æœåŠ¡
â”‚   â”œâ”€â”€ TaskPushBackgroundService.cs    # ä»»åŠ¡æ•°æ®æ¨é€åå°æœåŠ¡
â”‚   â””â”€â”€ HistoryApiService.cs            # å†å²æ•°æ®APIæœåŠ¡
```

**DronePushBackgroundService ä¸»è¦å‡½æ•°:**
- `ExecuteAsync(CancellationToken stoppingToken)` - æ‰§è¡Œåå°ä»»åŠ¡
- `PushDroneDataAsync()` - æ¨é€æ— äººæœºæ•°æ®
- `GetDroneUpdatesAsync()` - è·å–æ— äººæœºæ›´æ–°

**TaskPushBackgroundService ä¸»è¦å‡½æ•°:**
- `ExecuteAsync(CancellationToken stoppingToken)` - æ‰§è¡Œåå°ä»»åŠ¡
- `PushTaskDataAsync()` - æ¨é€ä»»åŠ¡æ•°æ®
- `GetTaskUpdatesAsync()` - è·å–ä»»åŠ¡æ›´æ–°

## ğŸ§¹ æ¶æ„é—®é¢˜å’Œæ¸…ç†å»ºè®®

### 1. ä»£ç é‡å¤é—®é¢˜

#### é—®é¢˜1: é‡å¤çš„æ•°æ®è®¿é—®é€»è¾‘
**ä½ç½®:** `TaskDataService.cs` å’Œ `SqlserverService.cs`
**é—®é¢˜:** æ•°æ®åº“æ“ä½œé€»è¾‘åˆ†æ•£åœ¨å¤šä¸ªæœåŠ¡ä¸­

**å»ºè®®æ¸…ç†:**
```csharp
// åˆ›å»ºç»Ÿä¸€çš„æ•°æ®è®¿é—®æ¥å£
public interface IRepository<T> where T : class
{
    Task<T> GetByIdAsync(Guid id);
    Task<IEnumerable<T>> GetAllAsync();
    Task<T> AddAsync(T entity);
    Task<T> UpdateAsync(T entity);
    Task<bool> DeleteAsync(Guid id);
}

// å®ç°å…·ä½“çš„ä»“å‚¨ç±»
public class TaskRepository : IRepository<MainTask>
public class DroneRepository : IRepository<Drone>
```

#### é—®é¢˜2: é‡å¤çš„é”™è¯¯å¤„ç†é€»è¾‘
**ä½ç½®:** å¤šä¸ªæœåŠ¡ç±»ä¸­çš„try-catchå—
**é—®é¢˜:** ç›¸åŒçš„å¼‚å¸¸å¤„ç†ä»£ç é‡å¤å‡ºç°

**å»ºè®®æ¸…ç†:**
```csharp
// åˆ›å»ºç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†ä¸­é—´ä»¶
public class GlobalExceptionMiddleware
{
    public async Task InvokeAsync(HttpContext context, RequestDelegate next)
    {
        try
        {
            await next(context);
        }
        catch (Exception ex)
        {
            await HandleExceptionAsync(context, ex);
        }
    }
}
```

### 2. æ¶æ„å±‚æ¬¡æ··ä¹±

#### é—®é¢˜3: æœåŠ¡èŒè´£ä¸æ¸…
**ä½ç½®:** `TaskDataService.cs`
**é—®é¢˜:** åŒæ—¶åŒ…å«ä¸šåŠ¡é€»è¾‘ã€æ•°æ®è®¿é—®å’Œç¼“å­˜é€»è¾‘

**å»ºè®®é‡æ„:**
```csharp
// åˆ†ç¦»å…³æ³¨ç‚¹
â”œâ”€â”€ Domain/
â”‚   â”œâ”€â”€ ITaskService.cs             # ä»»åŠ¡ä¸šåŠ¡æ¥å£
â”‚   â””â”€â”€ TaskService.cs              # ä»»åŠ¡ä¸šåŠ¡é€»è¾‘
â”œâ”€â”€ Infrastructure/
â”‚   â”œâ”€â”€ ITaskRepository.cs          # ä»»åŠ¡æ•°æ®è®¿é—®æ¥å£
â”‚   â””â”€â”€ TaskRepository.cs           # ä»»åŠ¡æ•°æ®è®¿é—®å®ç°
â””â”€â”€ Application/
    â”œâ”€â”€ TaskApplicationService.cs   # ä»»åŠ¡åº”ç”¨æœåŠ¡
    â””â”€â”€ TaskQueryService.cs         # ä»»åŠ¡æŸ¥è¯¢æœåŠ¡
```

### 3. æ€§èƒ½é—®é¢˜

#### é—®é¢˜4: ç¼ºä¹ç¼“å­˜ç­–ç•¥
**ä½ç½®:** `SqlserverService.cs`
**é—®é¢˜:** é¢‘ç¹çš„æ•°æ®åº“æŸ¥è¯¢æ²¡æœ‰ç¼“å­˜

**å»ºè®®ä¼˜åŒ–:**
```csharp
// æ·»åŠ ç¼“å­˜è£…é¥°å™¨
public class CachedTaskService : ITaskService
{
    private readonly ITaskService _taskService;
    private readonly IMemoryCache _cache;
    
    public async Task<MainTask> GetTaskAsync(Guid id)
    {
        return await _cache.GetOrCreateAsync($"task:{id}", 
            async entry =>
            {
                entry.AbsoluteExpirationRelativeToNow = TimeSpan.FromMinutes(5);
                return await _taskService.GetTaskAsync(id);
            });
    }
}
```

#### é—®é¢˜5: åŒæ­¥æ•°æ®åº“æ“ä½œ
**ä½ç½®:** `TaskDataService.cs` ä¸­çš„å¼‚æ­¥æ“ä½œ
**é—®é¢˜:** ä½¿ç”¨ `_ = Task.Run()` è¿›è¡Œåå°åŒæ­¥ï¼Œå¯èƒ½å¯¼è‡´æ•°æ®ä¸ä¸€è‡´

**å»ºè®®ä¼˜åŒ–:**
```csharp
// ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—è¿›è¡Œå¼‚æ­¥å¤„ç†
public class TaskEventHandler : INotificationHandler<TaskCreatedEvent>
{
    public async Task Handle(TaskCreatedEvent notification, CancellationToken cancellationToken)
    {
        await _sqlserverService.FullSyncMainTaskAsync(notification.Task);
    }
}
```

### 4. å®‰å…¨é—®é¢˜

#### é—®é¢˜6: ç¼ºä¹è¾“å…¥éªŒè¯
**ä½ç½®:** æ§åˆ¶å™¨æ–¹æ³•
**é—®é¢˜:** APIç«¯ç‚¹ç¼ºä¹è¾“å…¥éªŒè¯å’Œæˆæƒ

**å»ºè®®åŠ å¼º:**
```csharp
[HttpPost]
[Authorize]
[ValidateAntiForgeryToken]
public async Task<IActionResult> CreateTask([FromBody] CreateTaskRequest request)
{
    if (!ModelState.IsValid)
        return BadRequest(ModelState);
        
    // ä¸šåŠ¡é€»è¾‘
}

public class CreateTaskRequest
{
    [Required]
    [StringLength(200)]
    public string Description { get; set; }
    
    [Required]
    public DateTime ScheduledTime { get; set; }
}
```

### 5. å¯ç»´æŠ¤æ€§é—®é¢˜

#### é—®é¢˜7: ç¡¬ç¼–ç é…ç½®
**ä½ç½®:** å¤šä¸ªæœåŠ¡ç±»
**é—®é¢˜:** é­”æ³•æ•°å­—å’Œç¡¬ç¼–ç å­—ç¬¦ä¸²

**å»ºè®®æ”¹è¿›:**
```csharp
// ä½¿ç”¨é…ç½®é€‰é¡¹æ¨¡å¼
public class TaskServiceOptions
{
    public int MaxRetryAttempts { get; set; } = 3;
    public TimeSpan RetryDelay { get; set; } = TimeSpan.FromSeconds(5);
    public TimeSpan TaskTimeout { get; set; } = TimeSpan.FromMinutes(30);
}

// åœ¨æœåŠ¡ä¸­æ³¨å…¥é…ç½®
public class TaskDataService
{
    private readonly IOptions<TaskServiceOptions> _options;
    
    public TaskDataService(IOptions<TaskServiceOptions> options)
    {
        _options = options;
    }
}
```

## ğŸ“ æ¸…ç†è¡ŒåŠ¨è®¡åˆ’

### é˜¶æ®µ1: ç«‹å³æ¸…ç† (1-2å¤©)
1. **åˆ é™¤æœªä½¿ç”¨çš„ä»£ç **
   - `architecture-backup/` ç›®å½•ä¸­çš„æ—§æ–‡ä»¶
   - æ³¨é‡Šæ‰çš„ä»£ç å—
   - æœªä½¿ç”¨çš„usingè¯­å¥

2. **ç»Ÿä¸€å‘½åè§„èŒƒ**
   - æ–¹æ³•åä½¿ç”¨PascalCase
   - å˜é‡åä½¿ç”¨camelCase
   - å¸¸é‡ä½¿ç”¨UPPER_CASE

3. **æ·»åŠ ç¼ºå¤±çš„æ–‡æ¡£æ³¨é‡Š**
   - æ‰€æœ‰publicæ–¹æ³•æ·»åŠ XMLæ–‡æ¡£
   - å¤æ‚ä¸šåŠ¡é€»è¾‘æ·»åŠ å†…è”æ³¨é‡Š

### é˜¶æ®µ2: ç»“æ„é‡æ„ (3-5å¤©)
1. **å®ç°ä»“å‚¨æ¨¡å¼**
   - åˆ›å»ºé€šç”¨ä»“å‚¨æ¥å£
   - å®ç°å…·ä½“ä»“å‚¨ç±»
   - é‡æ„æ•°æ®è®¿é—®å±‚

2. **åˆ†ç¦»å…³æ³¨ç‚¹**
   - ä¸šåŠ¡é€»è¾‘å±‚åˆ†ç¦»
   - æ•°æ®è®¿é—®å±‚åˆ†ç¦»
   - è¡¨ç¤ºå±‚åˆ†ç¦»

3. **æ·»åŠ ç¼“å­˜å±‚**
   - å®ç°å†…å­˜ç¼“å­˜
   - å®ç°åˆ†å¸ƒå¼ç¼“å­˜
   - æ·»åŠ ç¼“å­˜ç­–ç•¥

### é˜¶æ®µ3: æ€§èƒ½ä¼˜åŒ– (2-3å¤©)
1. **å¼‚æ­¥ä¼˜åŒ–**
   - æ›¿æ¢åŒæ­¥æ–¹æ³•ä¸ºå¼‚æ­¥
   - ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢
   - å®ç°æ‰¹é‡æ“ä½œ

2. **æ·»åŠ ç›‘æ§**
   - æ€§èƒ½è®¡æ•°å™¨
   - æ—¥å¿—è®°å½•
   - å¥åº·æ£€æŸ¥

### é˜¶æ®µ4: å®‰å…¨åŠ å›º (2-3å¤©)
1. **è¾“å…¥éªŒè¯**
   - æ·»åŠ æ•°æ®æ³¨è§£
   - å®ç°è‡ªå®šä¹‰éªŒè¯å™¨
   - APIæˆæƒ

2. **é”™è¯¯å¤„ç†**
   - å…¨å±€å¼‚å¸¸å¤„ç†
   - è‡ªå®šä¹‰å¼‚å¸¸ç±»å‹
   - é”™è¯¯æ—¥å¿—è®°å½•

## ğŸ¯ é¢„æœŸæ”¶ç›Š

### ä»£ç è´¨é‡æå‡
- **å¯è¯»æ€§**: æå‡40%ï¼ˆé€šè¿‡ç»Ÿä¸€å‘½åå’Œæ–‡æ¡£ï¼‰
- **å¯ç»´æŠ¤æ€§**: æå‡50%ï¼ˆé€šè¿‡åˆ†ç¦»å…³æ³¨ç‚¹ï¼‰
- **å¯æµ‹è¯•æ€§**: æå‡60%ï¼ˆé€šè¿‡ä¾èµ–æ³¨å…¥å’Œæ¥å£æŠ½è±¡ï¼‰

### æ€§èƒ½æ”¹è¿›
- **å“åº”æ—¶é—´**: å‡å°‘30%ï¼ˆé€šè¿‡ç¼“å­˜å’Œå¼‚æ­¥ä¼˜åŒ–ï¼‰
- **æ•°æ®åº“å‹åŠ›**: å‡å°‘50%ï¼ˆé€šè¿‡ç¼“å­˜å’Œæ‰¹é‡æ“ä½œï¼‰
- **å†…å­˜ä½¿ç”¨**: å‡å°‘20%ï¼ˆé€šè¿‡å¯¹è±¡æ± å’Œèµ„æºç®¡ç†ï¼‰

### å®‰å…¨æ€§å¢å¼º
- **è¾“å…¥éªŒè¯**: 100%è¦†ç›–æ‰€æœ‰APIç«¯ç‚¹
- **å¼‚å¸¸å¤„ç†**: ç»Ÿä¸€é”™è¯¯å“åº”æ ¼å¼
- **æ—¥å¿—è®°å½•**: å®Œæ•´çš„å®¡è®¡è·Ÿè¸ª

## ğŸ“Š æ¸…ç†ä¼˜å…ˆçº§çŸ©é˜µ

| é¡¹ç›® | å½±å“ç¨‹åº¦ | å®ç°éš¾åº¦ | ä¼˜å…ˆçº§ |
|------|----------|----------|--------|
| åˆ é™¤æœªä½¿ç”¨ä»£ç  | ä½ | ä½ | é«˜ |
| ç»Ÿä¸€å‘½åè§„èŒƒ | ä¸­ | ä½ | é«˜ |
| å®ç°ä»“å‚¨æ¨¡å¼ | é«˜ | ä¸­ | é«˜ |
| æ·»åŠ ç¼“å­˜å±‚ | é«˜ | ä¸­ | ä¸­ |
| åˆ†ç¦»å…³æ³¨ç‚¹ | é«˜ | é«˜ | ä¸­ |
| æ€§èƒ½ä¼˜åŒ– | ä¸­ | ä¸­ | ä¸­ |
| å®‰å…¨åŠ å›º | é«˜ | é«˜ | ä½ |

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´:** {DateTime.Now:yyyy-MM-dd HH:mm:ss}
**åˆ†æèŒƒå›´:** å…¨éƒ¨.NETé¡¹ç›®æ–‡ä»¶
**åˆ†ææ·±åº¦:** å‡½æ•°çº§åˆ« 